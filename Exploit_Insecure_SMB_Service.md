# Exploit 4: Insecure SMB Service Exploit                                                                                  

## Discovery Process                                                                                  
We began the assessment by running a targeted Nmap scan to gather information about the SMB service running on the Metasploitable VM. This scan revealed the SMB service running on port 445, commonly used for file sharing and network resource access.

Nmap Scan Results:                                                                                  
We first ran the following Nmap scan with the smb-os-discovery script to gather version information about the SMB service and the underlying OS of the target:                                                                                  

![Nmap ](https://github.com/user-attachments/assets/0c9709bf-d75a-48d6-8fe5-a1ee996eb009)

The scan output provided details about the SMB service version and the operating system running on the target.                                                                                
Next, we used the smb-enum-users script to enumerate SMB users on the target machine:                                                                       

![Step_2_Nmap sub-enum-users ](https://github.com/user-attachments/assets/a5315b2e-cd60-41d7-8d8e-1adfcc274dee)
![399642762-41f13993-afd0-43fc-9ccc-1d1510420460](https://github.com/user-attachments/assets/a67e0b0e-14b2-4c87-8f09-db88154de9e8)

The output revealed a list of SMB users, including msfadmin, which we used in the subsequent exploitation phase.

## Exploitation:                                                                                  
**Step 1:** Enumerating SMB Shares                                                                                  
We used the smbclient tool to list the available SMB shares on the target machine.                                          
This was done by running the following command:                                                                             

![Step_3 smbclient](https://github.com/user-attachments/assets/387185e6-80da-4ec3-ae14-89da3b2e6493)

The scan revealed publicly accessible SMB shares, including tmp and Public, which were of interest for further exploration.

**Step 2:** Accessing the tmp Share                                                                                  
After identifying the tmp share, we accessed it using the following command:                                                 

![Step_5 Accessing Share](https://github.com/user-attachments/assets/baba1246-685d-4702-8d60-e7aa0745a683)

This successfully allowed us to connect to the tmp share. We were able to list and interact with the files stored in this directory.                                                                                  

**Step 3:** Extracting Sensitive Information                                                                                 
Upon exploring the tmp share, we found a file named .X0-lock. To confirm access, we used the get command to retrieve the file:                                                                                  

![Step 6](https://github.com/user-attachments/assets/c088c9cd-bcce-4153-9df0-032e7400144c)

This allowed us to download the .X0-lock file, which may contain valuable information regarding the target system's environment or configuration.                                                                                  

### Proof of Work:                                                                                  
We successfully accessed the tmp share and retrieved the .X0-lock file, demonstrating that access controls on SMB shares were improperly configured.                                                                                  

The .X0-lock file was extracted, showing that sensitive files were accessible due to the lack of restrictions on the SMB share.                                                                                  

### Recommendations for Mitigation:

1. Disable Anonymous SMB Access:                                                                                  
    - Modify the SMB configuration to prevent unauthenticated access to shares.

2. Enforce Strong Authentication Policies:                                                                                  
    - Require all users to authenticate with strong, unique credentials when accessing SMB shares.

3. Restrict SMB Share Permissions:                                                                                  
    - Implement the principle of least privilege to limit user access to only necessary files and directories.

4. Use Secure SMB Protocols:                                                                                  
    - Disable older, insecure SMB versions (e.g., SMBv1) and enforce the use of SMBv3 with encryption.

5. Enable Auditing and Monitoring:                                                                                  
    - Enable logging to track file access and modifications.
    - Deploy intrusion detection tools like Snort or Suricata to monitor SMB traffic.

6. Implement Network Segmentation:                                                                                  
    - Isolate sensitive SMB servers to reduce exposure to unauthorized access.
